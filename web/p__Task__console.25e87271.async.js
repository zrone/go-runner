(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[694],{69524:function(x,i,e){"use strict";e.r(i);var c=e(12399),A=e(82404),l=e(5317),m=e(87555),D=e(25324),h=e(45733),O=e(43623),U=e(28930),M=e(13753),P=e(48429),v=e(52222),r=e(65507),o=e(44742),T=e(53862),t=e(22657),Ee=e(14643),f=e(92909),j=e(68699),z=e(94043),p=e.n(z),n=e(67294),$=e(4688),L=e(9295),me=e.n(L),I=e(40760),de=e.n(I),W=e(11534),ie=e.n(W),F=e(27398),N=e(60268),R=e.n(N),G=e(56051),H=e.n(G),J=e(17993),X=function(){var K=(0,j.Z)(p().mark(function B(s){var C,u;return p().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return C=f.default.loading({content:"\u63D0\u4EA4\u4E2D...",key:"handleRetry"}),_.prev=1,_.next=4,(0,J.XD)(s);case 4:u=_.sent,u.code==400?f.default.error({content:u.message,key:"handleRetry",duration:2}):f.default.success({content:u.message,key:"handleRetry",duration:2}),_.next=11;break;case 8:_.prev=8,_.t0=_.catch(1),f.default.error({content:"\u91CD\u8BD5\u5931\u8D25!",key:"handleRetry",duration:2});case 11:return _.prev=11,setTimeout(function(){C()},2e3),_.finish(11);case 14:case"end":return _.stop()}},B,null,[[1,8,11,14]])}));return function(s){return K.apply(this,arguments)}}(),k=function(B){var s=B.location.query,C=s.symbol,u=s.pipline,Z=s.version,_=s.committer,ce=s.create_at,Q=s.end_at,V=t.Z.Header,Y=t.Z.Content,w=H()(Q*1e3).startOf("second").fromNow(),g=new L.Terminal({fontSize:14,disableStdin:!1,cursorStyle:"bar"}),S=new W.FitAddon;g.loadAddon(new I.WebLinksAddon),g.loadAddon(S);var q=(0,n.useState)(S),ee=(0,o.Z)(q,1),te=ee[0],ne=(0,n.useState)(g),_e=(0,o.Z)(ne,1),d=_e[0],ae=function(){R()(".tml .ant-card-body").height(R()(".rightMenu").height()-64+"px"),R()(".tml #terminal").height(R()(".rightMenu").height()-64+"px");var a=new WebSocket(F.Z.wss);se(a),re(a),oe(a),le(a)},re=function(a){a.onopen=function(){d.open(document.getElementById("terminal")),te.fit(),a.send(JSON.stringify({UUID:C}))}},se=function(a){a.onclose=function(){}},oe=function(a){a.onerror=function(){console.log("socket \u94FE\u63A5\u5931\u8D25")}},le=function(a){a.onmessage=function(ue){var b=JSON.parse(ue.data),y=b.data.msg.trim()+`\r
`;switch(b.data.level){case"info":d.write("[1;37m"+y+"[0m");break;case"error":d.write("[1;31m"+y+"[0m");break;case"debug":d.write("[1;32m"+y+"[0m");break;default:d.write("[1;35m"+y+"[0m");break}}};return(0,n.useEffect)(function(){ae()},[]),n.createElement($.Z,{className:"tml"},n.createElement(A.Z,null,n.createElement(t.Z,null,n.createElement(V,{className:"t-header"},n.createElement(m.Z,null,n.createElement(r.Z,{span:8},n.createElement("b",null,"#",Z),"\xA0",n.createElement("span",null,"triggered ",w," by"),"\xA0",_),n.createElement(r.Z,{span:8,offset:8,style:{textAlign:"right"}},n.createElement(h.Z,null,n.createElement(U.Z,{title:"\u60A8\u786E\u8BA4\u8981\u91CD\u8BD5\u6B64\u90E8\u7F72\u4EFB\u52A1\u5417?",onConfirm:function(){X(u)},okText:"\u91CD\u8BD5",cancelText:"\u53D6\u6D88"},n.createElement(P.Z,{danger:!0},"\u91CD\u8BD5")),n.createElement(P.Z,{onClick:function(){history.go(-1)},type:"primary"},"\u8FD4\u56DE"))))),n.createElement(Y,null,n.createElement("div",{id:"terminal"})))))};i.default=k},17993:function(x,i,e){"use strict";e.d(i,{oF:function(){return h},c_:function(){return U},XD:function(){return P}});var c=e(68699),A=e(94043),l=e.n(A),m=e(72709),D=e(27398);function h(r){return O.apply(this,arguments)}function O(){return O=(0,c.Z)(l().mark(function r(o){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.Z)("".concat(D.Z.host,"/task/console/list"),{params:o}));case 1:case"end":return t.stop()}},r)})),O.apply(this,arguments)}function U(r){return M.apply(this,arguments)}function M(){return M=(0,c.Z)(l().mark(function r(o){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.Z)("".concat(D.Z.host,"/task/release/list"),{params:o}));case 1:case"end":return t.stop()}},r)})),M.apply(this,arguments)}function P(r){return v.apply(this,arguments)}function v(){return v=(0,c.Z)(l().mark(function r(o){return l().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.Z)("".concat(D.Z.host,"/task/retry/").concat(o),{method:"POST",data:{}}));case 1:case"end":return t.stop()}},r)})),v.apply(this,arguments)}}}]);
